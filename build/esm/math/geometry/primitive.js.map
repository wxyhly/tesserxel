{"version":3,"file":"primitive.js","sources":["../../../../src/math/geometry/primitive.ts"],"sourcesContent":["import { Obj4 } from \"../algebra/affine.js\";\r\nimport { Vec4 } from \"../algebra/vec4.js\";\r\n\r\nexport class Ray {\r\n    origin: Vec4;\r\n    direction: Vec4;\r\n}\r\n\r\nexport class Plane {\r\n    /** normal need to be normalized */\r\n    normal: Vec4;\r\n    /** halfspace n.v < offset */\r\n    offset: number;\r\n    constructor(normal: Vec4, offset: number) {\r\n        this.normal = normal;\r\n        this.offset = offset;\r\n    }\r\n    clone(){\r\n        return new Plane(this.normal.clone(),this.offset);\r\n    }\r\n    applyObj4(o:Obj4){\r\n        if(o.scale) throw \"scaling plane is not implemented yet\";\r\n        this.normal.rotates(o.rotation);\r\n        this.offset += this.normal.dot(o.position);\r\n        return this;\r\n    }\r\n    distanceToPoint(p: Vec4) {\r\n        return this.normal.dot(p) - this.offset;\r\n    }\r\n    /** regard r as an infinity line */\r\n    distanceToLine(r: Ray) {\r\n        \r\n    }\r\n    intersectRay(r:Ray){\r\n        \r\n    }\r\n    \r\n}\r\nexport class AABB {\r\n    min: Vec4;\r\n    max: Vec4;\r\n    testAABB(aabb: AABB) {\r\n        return (\r\n            (this.min.x <= aabb.max.x && this.max.x >= aabb.min.x) &&\r\n            (this.min.y <= aabb.max.y && this.max.y >= aabb.min.y) &&\r\n            (this.min.z <= aabb.max.z && this.max.z >= aabb.min.z) &&\r\n            (this.min.w <= aabb.max.w && this.max.w >= aabb.min.w)\r\n        );\r\n    }\r\n    /** when intersected return 0, when aabb is along the normal direction return 1, otherwise -1 */\r\n    testPlane(plane: Plane) {\r\n        let min: number, max: number;\r\n        if (plane.normal.x > 0) {\r\n            min = plane.normal.x * this.min.x;\r\n            max = plane.normal.x * this.max.x;\r\n        } else {\r\n            min = plane.normal.x * this.max.x;\r\n            max = plane.normal.x * this.min.x;\r\n        }\r\n        if (plane.normal.y > 0) {\r\n            min += plane.normal.y * this.min.y;\r\n            max += plane.normal.y * this.max.y;\r\n        } else {\r\n            min += plane.normal.y * this.max.y;\r\n            max += plane.normal.y * this.min.y;\r\n        }\r\n        if (plane.normal.z > 0) {\r\n            min += plane.normal.z * this.min.z;\r\n            max += plane.normal.z * this.max.z;\r\n        } else {\r\n            min += plane.normal.z * this.max.z;\r\n            max += plane.normal.z * this.min.z;\r\n        }\r\n        if (plane.normal.w > 0) {\r\n            min += plane.normal.w * this.min.w;\r\n            max += plane.normal.w * this.max.w;\r\n        } else {\r\n            min += plane.normal.w * this.max.w;\r\n            max += plane.normal.w * this.min.w;\r\n        }\r\n        if (min <= plane.offset && max >= plane.offset) {\r\n            return 0;\r\n        }\r\n        if (min <= plane.offset && max <= plane.offset) {\r\n            return -1;\r\n        }\r\n        if (min >= plane.offset && max >= plane.offset) {\r\n            return 1;\r\n        }\r\n    }\r\n    getPoints() {\r\n        return [\r\n            new Vec4(this.min.x, this.min.y, this.min.z, this.min.w),\r\n            new Vec4(this.max.x, this.min.y, this.min.z, this.min.w),\r\n            new Vec4(this.min.x, this.max.y, this.min.z, this.min.w),\r\n            new Vec4(this.max.x, this.max.y, this.min.z, this.min.w),\r\n            new Vec4(this.min.x, this.min.y, this.max.z, this.min.w),\r\n            new Vec4(this.max.x, this.min.y, this.max.z, this.min.w),\r\n            new Vec4(this.min.x, this.max.y, this.max.z, this.min.w),\r\n            new Vec4(this.max.x, this.max.y, this.max.z, this.min.w),\r\n            new Vec4(this.min.x, this.min.y, this.min.z, this.max.w),\r\n            new Vec4(this.max.x, this.min.y, this.min.z, this.max.w),\r\n            new Vec4(this.min.x, this.max.y, this.min.z, this.max.w),\r\n            new Vec4(this.max.x, this.max.y, this.min.z, this.max.w),\r\n            new Vec4(this.min.x, this.min.y, this.max.z, this.max.w),\r\n            new Vec4(this.max.x, this.min.y, this.max.z, this.max.w),\r\n            new Vec4(this.min.x, this.max.y, this.max.z, this.max.w),\r\n            new Vec4(this.max.x, this.max.y, this.max.z, this.max.w),\r\n\r\n\r\n        ]\r\n    }\r\n    constructor(min?: Vec4, max?: Vec4) {\r\n        this.min = min ?? new Vec4(Infinity, Infinity, Infinity, Infinity,);\r\n        this.max = max ?? new Vec4(-Infinity, -Infinity, -Infinity, -Infinity,);\r\n    }\r\n    static fromPoints(points: Vec4[]) {\r\n        let aabb = new AABB();\r\n        for (let p of points) {\r\n            aabb.min.x = Math.min(aabb.min.x, p.x);\r\n            aabb.min.y = Math.min(aabb.min.y, p.y);\r\n            aabb.min.z = Math.min(aabb.min.z, p.z);\r\n            aabb.min.w = Math.min(aabb.min.w, p.w);\r\n            aabb.max.x = Math.max(aabb.max.x, p.x);\r\n            aabb.max.y = Math.max(aabb.max.y, p.y);\r\n            aabb.max.z = Math.max(aabb.max.z, p.z);\r\n            aabb.max.w = Math.max(aabb.max.w, p.w);\r\n        }\r\n        return aabb;\r\n    }\r\n}"],"names":[],"mappings":"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AAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACxD,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CA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"}